# Example .pre-commit-config.yaml for knots
#
# Copy this to your project as .pre-commit-config.yaml
# Then run: pre-commit install
#
# See https://pre-commit.com for more information

repos:
  # Standard pre-commit hooks
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-added-large-files
      - id: check-yaml

  # Code complexity checking with knots
  # Requires: knots binary installed (cargo install knots or download from releases)
  - repo: https://github.com/brandon-arrendondo/knots
    rev: v0.3.0
    hooks:
      # Standard complexity check
      # Default thresholds: McCabe: 15, Cognitive: 15, Nesting: 5, SLOC: 50, ABC: 10.0, Returns: 3
      # Shows only violations. Passes silently if no issues.
      - id: knots
        exclude: ^(Drivers/|Middlewares/)  # Exclude vendor/generated code

      # Uncomment for verbose output (shows summary even for passing files):
      # - id: knots-verbose

      # Uncomment for strict checking (McCabe: 10, Cognitive: 10, Nesting: 3, SLOC: 30, ABC: 5.0):
      # - id: knots-strict

      # For custom thresholds, use the standard hook with args:
      # Note: Custom thresholds automatically enable detailed analysis mode
      # - id: knots
      #   args:
      #     - --mccabe-threshold=20
      #     - --cognitive-threshold=15
      #     - --nesting-threshold=7
      #     - --sloc-threshold=100
      #     - --abc-threshold=15.0
      #     - --return-threshold=5

      # Test quality validation - for Ceedling framework
      # Parses TEST_SOURCE_FILE("path/to/source.c") macro from test files
      # Customize --test-dir for your test directory (Test/test/Tests/etc)
      # - id: test-complexity
      #   args:
      #     - --threshold=0.70
      #     - --boundary-threshold=0.80
      #     - --level=error
      #     - --framework=ceedling
      #     - --test-dir=Test

# Configuration for pre-commit.ci (if using)
ci:
  autofix_commit_msg: 'ci: auto fixes from pre-commit hooks'
  autoupdate_commit_msg: 'ci: pre-commit autoupdate'
